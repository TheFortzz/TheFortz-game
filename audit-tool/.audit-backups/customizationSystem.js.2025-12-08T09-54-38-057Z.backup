/**
 * Customization System for TheFortz
 * Tank skins, weapon skins, emotes, and cosmetic items
 */

const CustomizationSystem = {
    // Tank skins
    tankSkins: {
        // Default skins
        CLASSIC_BLUE: {
            id: 'classic_blue',
            name: 'Classic Blue',
            rarity: 'common',
            color: '#0066FF',
            pattern: 'solid',
            unlockLevel: 1,
            cost: 0
        },
        CLASSIC_RED: {
            id: 'classic_red',
            name: 'Classic Red',
            rarity: 'common',
            color: '#FF0000',
            pattern: 'solid',
            unlockLevel: 1,
            cost: 100
        },

        // Uncommon skins
        CAMO_FOREST: {
            id: 'camo_forest',
            name: 'Forest Camo',
            rarity: 'uncommon',
            colors: ['#2D5016', '#3F6B1B', '#4A7729'],
            pattern: 'camo',
            unlockLevel: 5,
            cost: 500
        },
        CAMO_DESERT: {
            id: 'camo_desert',
            name: 'Desert Camo',
            rarity: 'uncommon',
            colors: ['#C19A6B', '#EDC9AF', '#967969'],
            pattern: 'camo',
            unlockLevel: 5,
            cost: 500
        },
        STRIPES: {
            id: 'stripes',
            name: 'Racing Stripes',
            rarity: 'uncommon',
            colors: ['#FFFFFF', '#000000'],
            pattern: 'stripes',
            unlockLevel: 7,
            cost: 750
        },

        // Rare skins
        CHROME: {
            id: 'chrome',
            name: 'Chrome',
            rarity: 'rare',
            color: '#C0C0C0',
            pattern: 'metallic',
            effect: 'shine',
            unlockLevel: 10,
            cost: 1500
        },
        GOLD: {
            id: 'gold',
            name: 'Golden',
            rarity: 'rare',
            color: '#FFD700',
            pattern: 'metallic',
            effect: 'shine',
            unlockLevel: 15,
            cost: 2000
        },
        NEON: {
            id: 'neon',
            name: 'Neon Glow',
            rarity: 'rare',
            color: '#00FF00',
            pattern: 'solid',
            effect: 'glow',
            unlockLevel: 12,
            cost: 1800
        },

        // Epic skins
        GALAXY: {
            id: 'galaxy',
            name: 'Galaxy',
            rarity: 'epic',
            colors: ['#191970', '#4B0082', '#8A2BE2', '#FF1493'],
            pattern: 'galaxy',
            effect: 'sparkle',
            unlockLevel: 20,
            cost: 3000
        },
        FIRE: {
            id: 'fire',
            name: 'Inferno',
            rarity: 'epic',
            colors: ['#FF0000', '#FF4500', '#FFA500', '#FFD700'],
            pattern: 'fire',
            effect: 'flames',
            unlockLevel: 20,
            cost: 3000
        },
        ICE: {
            id: 'ice',
            name: 'Frozen',
            rarity: 'epic',
            colors: ['#00FFFF', '#87CEEB', '#B0E0E6', '#FFFFFF'],
            pattern: 'ice',
            effect: 'frost',
            unlockLevel: 20,
            cost: 3000
        },

        // Legendary skins
        RAINBOW: {
            id: 'rainbow',
            name: 'Rainbow',
            rarity: 'legendary',
            colors: ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#9400D3'],
            pattern: 'rainbow',
            effect: 'rainbow_trail',
            unlockLevel: 30,
            cost: 5000
        },
        PLASMA: {
            id: 'plasma',
            name: 'Plasma',
            rarity: 'legendary',
            colors: ['#00FF00', '#00FFFF', '#0000FF', '#FF00FF'],
            pattern: 'plasma',
            effect: 'electric',
            unlockLevel: 35,
            cost: 6000
        },
        VOID: {
            id: 'void',
            name: 'Void',
            rarity: 'legendary',
            colors: ['#000000', '#1A0033', '#330066'],
            pattern: 'void',
            effect: 'dark_aura',
            unlockLevel: 40,
            cost: 7000
        }
    },

    // Weapon skins
    weaponSkins: {
        RUSTY: {
            id: 'rusty',
            name: 'Rusty',
            rarity: 'common',
            color: '#8B4513',
            unlockLevel: 1,
            cost: 200
        },
        CHROME_WEAPON: {
            id: 'chrome_weapon',
            name: 'Chrome',
            rarity: 'rare',
            color: '#C0C0C0',
            effect: 'shine',
            unlockLevel: 10,
            cost: 1000
        },
        GOLD_WEAPON: {
            id: 'gold_weapon',
            name: 'Golden',
            rarity: 'epic',
            color: '#FFD700',
            effect: 'shine',
            unlockLevel: 20,
            cost: 2500
        },
        DIAMOND: {
            id: 'diamond',
            name: 'Diamond',
            rarity: 'legendary',
            color: '#B9F2FF',
            effect: 'sparkle',
            unlockLevel: 30,
            cost: 5000
        }
    },

    // Emotes
    emotes: {
        WAVE: {
            id: 'wave',
            name: 'Wave',
            icon: 'üëã',
            animation: 'wave',
            rarity: 'common',
            unlockLevel: 1,
            cost: 100
        },
        THUMBS_UP: {
            id: 'thumbs_up',
            name: 'Thumbs Up',
            icon: 'üëç',
            animation: 'thumbs_up',
            rarity: 'common',
            unlockLevel: 1,
            cost: 100
        },
        DANCE: {
            id: 'dance',
            name: 'Dance',
            icon: 'üíÉ',
            animation: 'dance',
            rarity: 'rare',
            unlockLevel: 10,
            cost: 500
        },
        VICTORY: {
            id: 'victory',
            name: 'Victory',
            icon: 'üèÜ',
            animation: 'victory',
            rarity: 'epic',
            unlockLevel: 15,
            cost: 1000
        },
        TAUNT: {
            id: 'taunt',
            name: 'Taunt',
            icon: 'üòé',
            animation: 'taunt',
            rarity: 'rare',
            unlockLevel: 12,
            cost: 750
        }
    },

    // Sprays
    sprays: {
        SMILEY: {
            id: 'smiley',
            name: 'Smiley',
            image: 'smiley.png',
            rarity: 'common',
            unlockLevel: 1,
            cost: 150
        },
        SKULL: {
            id: 'skull',
            name: 'Skull',
            image: 'skull.png',
            rarity: 'uncommon',
            unlockLevel: 5,
            cost: 300
        },
        FIRE_SPRAY: {
            id: 'fire_spray',
            name: 'Fire',
            image: 'fire.png',
            rarity: 'rare',
            unlockLevel: 10,
            cost: 600
        },
        LOGO: {
            id: 'logo',
            name: 'TheFortz Logo',
            image: 'logo.png',
            rarity: 'epic',
            unlockLevel: 20,
            cost: 1500
        }
    },

    // Player inventory
    playerInventory: {},

    // Initialize player inventory
    initPlayer(playerId) {
        if (!this.playerInventory[playerId]) {
            this.playerInventory[playerId] = {
                tankSkins: ['classic_blue'],
                weaponSkins: [],
                emotes: ['wave'],
                sprays: [],
                equipped: {
                    tankSkin: 'classic_blue',
                    weaponSkin: null,
                    emotes: ['wave', null, null, null], // 4 emote slots
                    spray: null
                }
            };
        }
    },

    // Purchase item
    purchaseItem(playerId, itemType, itemId, playerFortz) {
        this.initPlayer(playerId);

        let item;
        switch (itemType) {
            case 'tankSkin':
                item = this.tankSkins[itemId.toUpperCase()];
                break;
            case 'weaponSkin':
                item = this.weaponSkins[itemId.toUpperCase()];
                break;
            case 'emote':
                item = this.emotes[itemId.toUpperCase()];
                break;
            case 'spray':
                item = this.sprays[itemId.toUpperCase()];
                break;
            default:
                return { success: false, error: 'Invalid item type' };
        }

        if (!item) {
            return { success: false, error: 'Item not found' };
        }

        // Check if already owned
        const inventory = this.playerInventory[playerId];
        const inventoryKey = itemType + 's';
        if (inventory[inventoryKey].includes(item.id)) {
            return { success: false, error: 'Already owned' };
        }

        // Check if can afford
        if (playerFortz < item.cost) {
            return { success: false, error: 'Insufficient Fortz' };
        }

        // Add to inventory
        inventory[inventoryKey].push(item.id);

        return {
            success: true,
            cost: item.cost,
            item: item
        };
    },

    // Equip item
    equipItem(playerId, itemType, itemId, slot = 0) {
        this.initPlayer(playerId);
        const inventory = this.playerInventory[playerId];

        // Check if owned
        const inventoryKey = itemType + 's';
        if (!inventory[inventoryKey].includes(itemId)) {
            return { success: false, error: 'Item not owned' };
        }

        // Equip
        if (itemType === 'emote') {
            inventory.equipped.emotes[slot] = itemId;
        } else {
            inventory.equipped[itemType] = itemId;
        }

        return { success: true };
    },

    // Get player loadout
    getLoadout(playerId) {
        this.initPlayer(playerId);
        return this.playerInventory[playerId].equipped;
    },

    // Get all items of type
    getItemsByType(itemType) {
        switch (itemType) {
            case 'tankSkin':
                return Object.values(this.tankSkins);
            case 'weaponSkin':
                return Object.values(this.weaponSkins);
            case 'emote':
                return Object.values(this.emotes);
            case 'spray':
                return Object.values(this.sprays);
            default:
                return [];
        }
    },

    // Get items by rarity
    getItemsByRarity(rarity) {
        const allItems = [
            ...Object.values(this.tankSkins),
            ...Object.values(this.weaponSkins),
            ...Object.values(this.emotes),
            ...Object.values(this.sprays)
        ];

        return allItems.filter(item => item.rarity === rarity);
    },

    // Get unlocked items for player level
    getUnlockedItems(playerLevel) {
        const allItems = [
            ...Object.values(this.tankSkins),
            ...Object.values(this.weaponSkins),
            ...Object.values(this.emotes),
            ...Object.values(this.sprays)
        ];

        return allItems.filter(item => item.unlockLevel <= playerLevel);
    }
};

// Export
if (typeof window !== 'undefined') {
    window.CustomizationSystem = CustomizationSystem;
}
